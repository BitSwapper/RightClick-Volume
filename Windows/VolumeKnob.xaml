<Window x:Class="RightClickVolume.VolumeKnob"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:RightClickVolume"
        mc:Ignorable="d"
        Title="Volume Knob"
        Width="70" Height="300"
        SizeToContent="Manual"
        WindowStyle="None"
        ResizeMode="NoResize"
        ShowInTaskbar="False"
        BorderThickness="0"
        Topmost="True"
        AllowsTransparency="True"
        Background="Transparent"
        Focusable="True"
        WindowStartupLocation="Manual">

    <!-- ========================== -->
    <!--      RESOURCES START       -->
    <!-- ========================== -->
    <Window.Resources>

        <!-- Converter (Ensure ValueToHeightConverter exists in the 'local' namespace) -->
        <local:ValueToHeightConverter x:Key="ValueToHeightConverter"/>
        

        <!-- Base Button Style -->
        <Style x:Key="ModernButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#CCCCCC"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="FontFamily" Value="Segoe UI Symbol"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="buttonBorder" Background="{TemplateBinding Background}" CornerRadius="12">
                            <Viewbox Stretch="Uniform" Margin="6">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Viewbox>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="buttonBorder" Property="Background" Value="#5A5A5A"/>
                                <Setter Property="Foreground" Value="#FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="buttonBorder" Property="Background" Value="#6A6A6A"/>
                                <Setter Property="Foreground" Value="#FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Mute Button Style -->
        <Style x:Key="MuteButtonStyle" TargetType="Button" BasedOn="{StaticResource ModernButtonStyle}">
            <Setter Property="FontFamily" Value="Segoe UI Emoji"/>
            <Setter Property="FontSize" Value="10"/>
            <!-- Background/Foreground set dynamically in code-behind -->
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#5A5A5A"/>
                    <Setter Property="Foreground" Value="#FFFFFF"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#6A6A6A"/>
                    <Setter Property="Foreground" Value="#FFFFFF"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Slider Thumb Style -->
        <Style x:Key="VolumeSliderThumbStyle" TargetType="{x:Type Thumb}">
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="Height" Value="18"/>
            <Setter Property="Width" Value="18"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Thumb}">
                        <Grid>
                            <Ellipse x:Name="grip" Fill="#E0E0E0" Stroke="#AAAAAA" StrokeThickness="0.5">
                                <Ellipse.Effect>
                                    <DropShadowEffect ShadowDepth="1" Direction="270" Color="Black" Opacity="0.3" BlurRadius="3"/>
                                </Ellipse.Effect>
                            </Ellipse>
                            <Ellipse Margin="5" Opacity="0.6">
                                <Ellipse.Fill>
                                    <RadialGradientBrush Center="0.5,0.5" RadiusX="0.5" RadiusY="0.5">
                                        <GradientStop Color="#FFFFFF" Offset="0"/>
                                        <GradientStop Color="#E0E0E0" Offset="1"/>
                                    </RadialGradientBrush>
                                </Ellipse.Fill>
                            </Ellipse>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="grip" Property="Fill" Value="#FFFFFF"/>
                                <Setter TargetName="grip" Property="Stroke" Value="#888888"/>
                            </Trigger>
                            <Trigger Property="IsDragging" Value="True">
                                <Setter TargetName="grip" Property="Fill" Value="#F0F0F0"/>
                                <Setter TargetName="grip" Property="Stroke" Value="#666666"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Empty RepeatButton Style for Slider Track -->
        <Style x:Key="SliderButtonStyle" TargetType="RepeatButton">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RepeatButton">
                        <Border Background="Transparent"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Volume Slider Style -->
        <Style x:Key="VolumeSliderStyle" TargetType="{x:Type Slider}">
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="OverridesDefaultStyle" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Slider}">
                        <Grid>
                            <!-- Track Background -->
                            <Border x:Name="TrackBackground" Width="8" CornerRadius="4" HorizontalAlignment="Center" VerticalAlignment="Stretch">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0.5, 0" EndPoint="0.5, 0.7">
                                        <GradientStop Color="#FF525252" Offset="0.0" />
                                        <GradientStop Color="#101010" Offset="1.0" />
                                    </LinearGradientBrush>
                                </Border.Background>
                            </Border>

                            <!-- Filled part of Track -->
                            <Border x:Name="PART_SelectionRange" Width="8" CornerRadius="4" HorizontalAlignment="Center" VerticalAlignment="Bottom">
                                <Border.Height>
                                    <MultiBinding Converter="{StaticResource ValueToHeightConverter}">
                                        <Binding Path="Value" RelativeSource="{RelativeSource TemplatedParent}" />
                                        <Binding RelativeSource="{RelativeSource TemplatedParent}" />
                                    </MultiBinding>
                                </Border.Height>
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0.5,1" EndPoint="0.5,0">
                                        <GradientStop Color="#03A9F4" Offset="0.0" />
                                        <GradientStop Color="#4FC3F7" Offset="1.0" />
                                    </LinearGradientBrush>
                                </Border.Background>
                            </Border>

                            <!-- Track Control (hosts Thumb) -->
                            <Track x:Name="PART_Track" Orientation="Vertical">
                                <Track.Thumb>
                                    <Thumb x:Name="Thumb" Style="{StaticResource VolumeSliderThumbStyle}" />
                                </Track.Thumb>
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Command="Slider.DecreaseLarge" Style="{StaticResource SliderButtonStyle}" />
                                </Track.DecreaseRepeatButton>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Command="Slider.IncreaseLarge" Style="{StaticResource SliderButtonStyle}"/>
                                </Track.IncreaseRepeatButton>
                            </Track>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="PART_SelectionRange" Property="Opacity" Value="0.4"/>
                                <Setter TargetName="Thumb" Property="IsEnabled" Value="False"/>
                                <Setter TargetName="Thumb" Property="Opacity" Value="0.4"/>
                                <Setter TargetName="TrackBackground" Property="Opacity" Value="0.6"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <!-- Optional hover effect -->
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Style for the Peak Volume Meter (ProgressBar) -->
        <Style x:Key="PeakMeterStyle" TargetType="ProgressBar">
            <Setter Property="Orientation" Value="Vertical"/>
            <Setter Property="Width" Value="10"/>
            <!-- Adjust width as needed -->
            <Setter Property="Background" Value="#FF383838"/>
            <!-- Background of the meter track -->
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground">
                <!-- This is the fill of the progress bar -->
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0.5,1" EndPoint="0.5,0">
                        <!-- Fills from bottom (green) to top (red) -->
                        <GradientStop Color="GreenYellow" Offset="0.0" />
                        <GradientStop Color="#A2FF00" Offset="0.4" />
                        <!-- Brighter Green -->
                        <GradientStop Color="Yellow" Offset="0.75" />
                        <GradientStop Color="OrangeRed" Offset="0.9" />
                        <GradientStop Color="Red" Offset="1.0" />
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <!-- Optional: Apply a simple template for rounded corners if default isn't sufficient -->
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ProgressBar">
                        <Border x:Name="TemplateRoot"
                                CornerRadius="4"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <Grid>
                                <Rectangle x:Name="PART_Track" />
                                <Rectangle x:Name="PART_Indicator"
                                           Fill="{TemplateBinding Foreground}"
                                           HorizontalAlignment="Stretch"
                                           VerticalAlignment="Bottom" />
                                <!-- WPF's ProgressBar logic for Orientation="Vertical" 
                                     will adjust PART_Indicator's Height based on Value -->
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.4"/>
                </Trigger>
            </Style.Triggers>
        </Style>

    </Window.Resources>
    <!-- ========================== -->
    <!--       RESOURCES END        -->
    <!-- ========================== -->

    <Border CornerRadius="10" BorderThickness="0">
        <Border.Background>
            <RadialGradientBrush GradientOrigin="0.5, 0.5" Center="0.5,0.5" RadiusX="1" RadiusY="2">
                <GradientStop Color="#FF444444" Offset="0.0" />
                <GradientStop Color="#BB2A2A2A" Offset="1.0" />
            </RadialGradientBrush>
        </Border.Background>
        <Border.Effect>
            <DropShadowEffect ShadowDepth="3" Direction="315" Color="Black" Opacity="0.4" BlurRadius="8"/>
        </Border.Effect>

        <!-- Main Content Grid -->
        <Grid Margin="6">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <!-- Row 0: Buttons -->
                <RowDefinition Height="Auto" />
                <!-- Row 1: Current Volume Text -->
                <RowDefinition Height="33*"  />
                <!-- Row 2: Slider Area (Part 1) -->
                <RowDefinition Height="146*" />
                <!-- Row 2: Slider Area (Part 2) -->
                <RowDefinition Height="Auto" />
                <!-- Row 3: App Name -->
            </Grid.RowDefinitions>

            <!-- Row 0: Buttons -->
            <Grid Grid.Row="0" Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Button x:Name="MuteButton" Grid.Column="0" Content="🔊" Style="{StaticResource MuteButtonStyle}" HorizontalAlignment="Left" ToolTip="Mute/Unmute" Click="MuteButton_Click"/>
                <Button x:Name="CloseButton" Grid.Column="1" Content="✕" Style="{StaticResource ModernButtonStyle}" HorizontalAlignment="Right" ToolTip="Close" Click="CloseButton_Click"/>
            </Grid>

            <!-- Row 1: Current Volume Text -->
            <TextBlock x:Name="TextCurVol" Grid.Row="1" Text="{Binding CurVol, FallbackValue=50, TargetNullValue=--}" Foreground="#EFEFEF" FontWeight="DemiBold" FontSize="20" TextAlignment="Center" Margin="0,0,0,5"/>

            <!-- Row 2 & 3 (spanned): Volume Slider and Peak Meter -->
            <Grid Grid.Row="2" Grid.RowSpan="2"
                        HorizontalAlignment="Center" VerticalAlignment="Stretch" Margin="0,8,0,8">

                <!-- Volume Control Slider -->
                <Slider x:Name="VolumeSlider"
                        Orientation="Vertical"
                        Minimum="0" Maximum="100"
                        Value="{Binding Volume, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        IsDirectionReversed="False"
                    ValueChanged="VolumeSlider_ValueChanged"
                        Style="{StaticResource VolumeSliderStyle}"
                        VerticalAlignment="Stretch"
                        Panel.ZIndex="1"
                        Margin="0,0,0,0"/>
                    <!-- Margin to space it from peak meter -->

                    <!-- Peak Volume Meter -->
                <ProgressBar x:Name="PeakVolumeMeter"
                             BorderThickness="0"
             Orientation="Vertical"
             Foreground="#7F0A9A34"
             Background="Transparent"             
             Width="10"
             Minimum="0" Maximum="100"
             Value="{Binding PeakLevel, Mode=OneWay, FallbackValue=0}"
             VerticalAlignment="Stretch"
             IsEnabled="{Binding Path=IsEnabled, ElementName=VolumeSlider}"/>
                
            </Grid>

            <!-- Row 4 (was Row 3): App Name Text -->
            <TextBlock x:Name="AppNameTextBlock" Grid.Row="4" Text="{Binding AppName, FallbackValue=Application Name, TargetNullValue=Unknown App}" Foreground="#DDDDDD" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" TextAlignment="Center" FontSize="11" Margin="0,8,0,0"/>
        </Grid>
        <!-- End Main Content Grid -->

    </Border>
    <!-- End Main Container Border -->
</Window>